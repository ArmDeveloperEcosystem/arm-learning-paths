---
title: "Run the Mac pipeline (collect traces + metrics)"
weight: 7
layout: "learningpathall"
---

<p>
  <img
    src="/learning-paths/embedded-and-microcontrollers/sme-executorch-profiling/images/step05_run.svg"
    alt="Outcome: run directory populated with traces and metrics"
    class="content-uploaded-image centered"
  />
  <span class="content-image-caption centered">
    Outcome: runs/mac populated with metrics and ETDump traces.
  </span>
</p>

## Goal of this step

Execute the same `.pte` model with the SME2-on and SME2-off runners and collect:
- end-to-end latency summaries (`metrics.json`)
- operator-level traces (`*.etdump`)
- run provenance (`manifest.json`, including ExecuTorch SHA)

**Time:** ~5–10 minutes (10 runs per variant × 2 variants)

## Do this now
```bash
# Start from a template config and edit just two things:
# 1) the model path
# 2) runner paths (if you used different directories)
cp configs/templates/mac_template.json configs/mac.json

# Edit configs/mac.json:
# - set "model" to: "models/mobilenet_v3_small_fp16.pte"
# - confirm runner_path entries point at:
#   - runners/mac_sme2_on/executor_runner
#   - runners/mac_sme2_off/executor_runner

# (optional) Use Python to set the model path without manual editing
python - <<'PY'
import json
p="configs/mac.json"
d=json.load(open(p))
d["model"]="models/mobilenet_v3_small_fp16.pte"
json.dump(d, open(p,"w"), indent=2)
print("updated", p)
PY

# Run the pipeline (writes results under runs/mac/)
python scripts/mac_pipeline.py --config configs/mac.json
```

## You should see

After the pipeline completes, expect a `runs/mac/` directory with:

| File/Directory | Location | Typical Size | Purpose |
|----------------|----------|--------------|---------|
| `manifest.json` | `runs/mac/` | ~1–2 KB | Records ExecuTorch SHA, model path, experiment configs |
| `metrics.json` | `runs/mac/` | ~500 B–1 KB | End-to-end latencies per experiment (median, mean, p50, p90) |
| `mac_sme2_on/` | `runs/mac/` | — | Experiment directory for SME2-on variant |
| `mac_sme2_off/` | `runs/mac/` | — | Experiment directory for SME2-off variant |
| `*.etdump` | `runs/mac/mac_sme2_*/` | 50–500 KB each | Operator-level profiling traces (binary format) |
| `*.log` | `runs/mac/mac_sme2_*/` | Variable | Runner stdout/stderr (should contain "Model executed successfully") |

{{% notice Note %}}
These files are used directly by the next step (`06-analyze-results.md`). In particular, `analysis_summary.json` is generated by reading the `.etdump` traces and correlating them via the `.etrecord`.
{{% /notice %}}

If any files are missing, check runner logs for errors (common: model path incorrect, runner not built, missing `.etrecord`).

## Validate structure

```bash
python scripts/validate_results.py --results runs/mac
python scripts/compare_run_to_known_good.py --run-dir runs/mac
```

If validation passes, your run matches the expected schema (manifest + metrics + ETDump present).

---

**Next:** Analyze results (operator breakdown + kernel hints).
